{{define "title"}}<title>Pelanggan</title>{{end}}
{{define "content"}}

  <div class="content" ng-app="App" ng-controller="Controller">
    <div class="box">
      <h1 style="float:left;  font-family: Roboto;"  class="textColor">
        <span class="glyphicon glyphicon-user"></span>
        Pelanggan
      </h1>
    </div>
    <form ng-submit="getCustomers()" class="" method="post">
      <input class="searchBox" ng-model="customerSearchQuery" type="text" placeholder="Cari..." name="" value="">
    </form>
    <span style="font-size:20px;color:#03A9F4;float:left;margin-left:-50px;margin-top:15px;font-weight:bolder;" class="glyphicon glyphicon-search">
    </span>
    <div class="tbl-wrapper">
      <table class="tbl-vertical-v1 darkPrimaryColorBackground">
        <tr>
          <td>Nama Pelanggan</td>
          <td>
            <button ng-click="goToCreateCustomer()" type="button" class="glyphicon glyphicon-plus-sign btn-medium-v1"  name="button"></button>
          </td>

        </tr>

        <tr ng-repeat="c in customers">
          <td>((c.name))</td>
          <td>
            <button type="button" class="glyphicon glyphicon-edit btn-medium-v1"  name="button"></button>
            <button ng-click="viewCustomer(c)" type="button" class="glyphicon glyphicon-eye-open btn-medium-v1"  name="button"></button>
            <button type="button" class="glyphicon glyphicon-trash btn-medium-v1"  name="button"></button>
            <span class="btn-medium-v1 glyphicon glyphicon-print" type="button" name="button"></span>
            <button class="btn-medium-v2" type="button" ng-click="goToPrintAlamat(c)" name="button">ALAMAT</button>
            <button class="btn-medium-v2" type="button" name="button">SURAT JALAN</button>
          </td>
        </tr>
      </table>
      <div a ng-view>

      </div>
    </div>


  </div>

  <script type="text/javascript">
    const app = angular.module("App",['ngRoute'])
    window.onload = function() {
      window.location.href = "http://localhost:345/pelanggan#!/"
    }
    app.controller("Controller",function($scope,$http,$sce){
      $scope.addCustomer = function(){
        $http({
    method : "POST",
    url : "http://localhost:444/api/customers",
    data : {
      cells : $scope.invalidData
    },
    headers : {
      "Content-Type" : "application/x-www-form-urlencoded"
    }
  }).then(function(){
    $scope.invalidData = null
    $scope.invalidDataLen = 0
    $scope.state = "correctionApplied"
  })

      }

      $scope.addCustomer()
      $scope.viewedCustomer = {}
      $scope.customers = []
      $scope.getCustomers = function(){
        if ($scope.customerSearchQuery == "" || $scope.customerSearchQuery == undefined) {
          $http.get("http://localhost:444/api/customers").then(function(res){
            $scope.customers = res.data.result

          })
        }
        else {
          $http.get("http://localhost:444/api/customers?s="+$scope.customerSearchQuery).then(function(res){
            $scope.customers = res.data.result
          })
        }

      }
      $scope.viewCustomer = function(customer) {
        $scope.viewedCustomer = JSON.parse(JSON.stringify(customer))
        $scope.viewedCustomer.information = $sce.trustAsHtml($scope.viewedCustomer.information)
        window.location.href = "http://localhost:345/pelanggan#!/lihatPelanggan"
      }
      $scope.goToCreateCustomer = function() {
        window.location.href = "http://localhost:345/pelanggan#!/tambahPelanggan"
      }


      $scope.getCustomers()

      $scope.goToPrintAlamat = function(customer) {
        localStorage.setItem("customerStorage",JSON.stringify(customer))
        window.open("/printAlamat")
      }
    })


    app.config(function($routeProvider) {
      $routeProvider
      .when("/", {
        templateUrl : "spaViews/tambahPelanggan.html",
        controller : "TambahPelangganController"
      })
      .when("/lihatPelanggan", {
        templateUrl : "spaViews/lihatPelanggan.html"
      })
      .when("/tambahPelanggan", {
        templateUrl : "spaViews/tambahPelanggan.html"
      })
      .when("/ubahPelanggan", {
        templateUrl : "spaViews/ubahPelanggan.html"
      });
    });

    app.controller("TambahPelangganController",function($scope,$http){
      $scope.addCustomer = function(){
        $http({
          method : "POST",
          url : "http://localhost:444/api/customers",
          data : {
            customerName : $scope.customerName,
            customerInformation : $scope.customerInformation,
          },
          header : {
            'Content-Type' : "application/x-www-form-urlencoded"
          },
        }).then(function(){
          alert("Successfuly Added New Customer")
        })
      }
    })

    app.config(function($interpolateProvider) {
      $interpolateProvider.startSymbol('((');
      $interpolateProvider.endSymbol('))');
    });

  </script>



{{end}}
